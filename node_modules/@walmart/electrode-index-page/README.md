# electrode-index-page

Generate HTML index page for Electrode App (replaces [@walmart/electrode-react-webapp2] or [@walmart/electrode-react-webapp])

## Overview

For basic usage, this module is a drop-in replacement for [@walmart/electrode-react-webapp2] or [@walmart/electrode-react-webapp].

Internally, the code has been completely rewritten to offer some very flexible way for you to customize, extend, and debug your index page.

## Basic Usage

The same usage as [@walmart/electrode-react-webapp2] or [@walmart/electrode-react-webapp] is maintained.

All original `options` are supported.

- Quick Steps
  1.  remove [@walmart/electrode-react-webapp2] from your dependencies
  2.  add `@walmart/electrode-index-page` to your dependencies
  3.  In your `config` directory, change any occurrences of `@walmart/electrode-react-webapp2` to `@walmart/electrode-index-page`.

> Do the same if you are using [@walmart/electrode-react-webapp].

**WARNING**: While backward compatibility is maintained, the generated output isn't exactly binary equivalent. Please do your due diligence to verify the output in **production** mode, especially if your app requires PCI compliance.

**ERROR PAGES**: The old model of generating error pages in `@walmart/electrode-react-webapp2` was not flexible enough because different apps may need to generate their own error pages.

### electrode-wml-app

If you are using [@walmart/electrode-wml-app], then you should update that to the following versions accordingly so it pulls in this module.

- If you are using major version 2 - `2.2.0`
- If you are using major version 3 - `3.1.0`

## Customization and Debugging

### Error Pages

The old model of generating error pages in `@walmart/electrode-react-webapp2` was not flexible enough because different apps may need to generate their own error pages.

`@walmart/electrode-index-page` comes with 404 and 5xx error pages provided by [@walmart/electrode-error-page]. These are error pages with generic Walmart styles.

Please see this [PR](https://gecgithub01.walmart.com/electrode/electrode-index-page/pull/29) to see how the generic error pages look like.

If your app needs to provide its own error pages, then you need to provide two function hooks in the `options`:

```js
{
  plugins: {
    "@walmart/electrode-index-page": {
      options: {
        responseForError: (request, routeOptions, err) => {
          return {
            status: err.status,
            html: "<html><body>not found</body></html>"
          };
        },
        responseForBadStatus: (request, routeOptions, err) => {
          return {
            status: err.status,
            html: "<html><body>something was wrong</body></html>"
          }
        }
      }
    }
  }
}
```

- `responseForError` - this hook is for when there's an unexpected exception through the rendering process that the render engine did not handle.

- `responseForBadStatus` - this hook is for when your content return an object with `status` being non 200 and `html` being defined (ie. not `undefined`).

  - This is default to `null`, so if `content.status` is non 200, the rendered result is still returned.

  - You can override this so the rendering process will invoke it to replace the rendered result.

### Token and Template

This module uses the OSS [electrode-react-webapp] internally for its template and token system. Please refer to [electrode-react-webapp design] doc for some initial readings on the basic of the tokens.

Here are some high level things to give you some ideas on what's possible before you have to figure out how tokens work.

- Your own template file - You can supply your own template file with different content and tokens.
- Replace default token handlers - You can supply your own token handlers to replace existing default tokens.
- Define your own tokens - Your token handlers can define new tokens to be used in your own template.
- `require` a token module directly - If you don't want to define a token, then you can just load your module directly.
- Modify default template - You can programmatically insert/remove/replace tokens from the default template (in case you just want to make a small change rather than having your own template file.)

### Token Handler Capabilities

Here are some main things your token handlers can do:

- Define to be `null` - turn off the token
- Define to a literal string - your token handler can simply be a literal string to be inserted into the output
- Define to a function - offers you flexibility to supply the data for the output

#### Function Handler

If you define your own token or load a module directly, your token handler can be a function.

Here are things your function can do:

- Return a literal string directly
- Return a Promise that asynchrounously resolve to a string
- Reserve your token's spot in the output and generate the data for it asynchronously. This can be particularly useful if you don't want the rendering to wait for your token handler. The spot you reserve is remembered while the renderer continues to process other tokens and output.

#### Debugging

You can set `options.insertTokenIds` to true and the renderer will generate output with the token IDs.

For example, you will get output like this:

```html
<!-- INITIALIZE -->
<!-- $~INITIALIZE~$ -->
<html>
<!DOCTYPE html>
<html lang="en">

<head>
<!-- HEAD_INITIALIZE removed due to its handler set to null -->
<!-- WML_FIRST_SCRIPTS -->
<script>...</script>
<!-- $~WML_FIRST_SCRIPTS~$ -->
...
</head>
...
```

[@walmart/electrode-react-webapp]: https://gecgithub01.walmart.com/electrode/electrode-react-webapp
[@walmart/electrode-react-webapp2]: https://gecgithub01.walmart.com/electrode/electrode-react-webapp2
[@walmart/electrode-wml-app]: http://gecgithub01.walmart.com/electrode/electrode-wml-app
[electrode-react-webapp]: https://www.npmjs.com/package/electrode-react-webapp
[electrode-react-webapp design]: https://github.com/electrode-io/electrode/blob/master/packages/electrode-react-webapp/DESIGN.md
[@walmart/electrode-error-page]: https://gecgithub01.walmart.com/electrode/electrode-error-page
