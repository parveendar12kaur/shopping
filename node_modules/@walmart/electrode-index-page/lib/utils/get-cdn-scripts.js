"use strict";

/* eslint-disable no-magic-numbers */

const getClientScript = require("./get-client-script");
const clientCdnMap = getClientScript(`client-cdn-map`);
const makeRunScript = require("./make-run-script");

const { mapCdnAssets } = require("./index");

module.exports = function getCdnScripts(options) {
  if (!options.cdn.enabled) return [];

  const cdnMap = mapCdnAssets(options.__internals.cdnAssets);

  const cdnScripts = [];

  if (cdnMap) {
    const md = JSON.stringify(cdnMap, null, 2);

    const cdnMapScript = `window._wml.cdn={
md:${md},
map:${clientCdnMap.toString()}
}/*CDN*/;`;

    cdnScripts.push(cdnMapScript);
  }

  cdnScripts.push(makeRunScript("rewrite-cdn-host", "", "RCDN"));

  return cdnScripts;
};
