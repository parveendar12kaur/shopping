"use strict";

const objectToProps = require("../utils/object-to-props");
const memoizeTag = Symbol.for("electrode-index-page-built-metaTags");

const htmlifyMetaTags = metaTags => {
  const x = Object.keys(metaTags)
    .map(name => {
      const mt = metaTags[name];
      if (Array.isArray(mt)) {
        return `<meta ${mt.join(" ")}/>`;
      } else if (typeof mt === "object") {
        const attrs = objectToProps(mt);
        return `<meta${attrs}/>`;
      } else {
        return `<meta name="${name}" content="${mt}"/>`;
      }
    })
    .join("");
  return x;
};

module.exports = context => {
  const routeOptions = context.user.routeOptions;

  if (routeOptions.hasOwnProperty(memoizeTag)) return routeOptions[memoizeTag];

  if (routeOptions.metaTags) {
    return (routeOptions[memoizeTag] = htmlifyMetaTags(routeOptions.metaTags.app));
  }

  return (routeOptions[memoizeTag] = "");
};
