"use strict";

const EventEmitter = require("events").EventEmitter;
const assert = require("assert");
const fs = require("fs");
const os = require("os");

class FileWriter extends EventEmitter {

  constructor(options) {
    super();
    assert(options && typeof options.filePath === "string",
           "options.filePath is required");
    this._filePath = options.filePath;
    this._createStream();
  }

  _createStream() {
    this._fileStream = fs.createWriteStream(this._filePath, { flags: "a" });
    const self = this;

    this._fileStream.on("error", (err) => {
      if (err.code === "ENOENT") {
        self._fileStream.end();
      }
      self.emit("error", err);
    });
  }

  write(message) {
    const buffer = new Buffer(message + os.EOL);
    this._fileStream.write(buffer);
  }
}

module.exports = FileWriter;
