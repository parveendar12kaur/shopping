"use strict";

const _ = require("lodash");

const base = require("./base");
const wmHeaders = require("@walmart/electrode-wml-soa").wmHeaders;

module.exports = request => {
  if (!request || !request.response) {
    return;
  }
  const eventData = {
    endpoint: _.get(request, "route.path"),
    status: request.response.statusCode,
    serviceName: request.headers[wmHeaders.svcName]
  };

  if (request.info.responded && request.info.received) {
    eventData.duration = request.info.responded - request.info.received;
  }
  base.sendEvent("response", eventData);
};
