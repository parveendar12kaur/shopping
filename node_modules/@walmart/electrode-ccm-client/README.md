# electrode-ccm-client

## Install

```sh
npm install @walmart/electrode-ccm-client --save
```

## Usage

In your configuration `config/default.json`, add `"@walmart/electrode-ccm-client"` to `config.services.providers`.

```js
{
  "services": {
    "providers": {
      "@walmart/electrode-ccm-client": {
        "options": {
          "environment": "DEV",
          "cloudEnvironment": "dev",
          "cloud": "local",
          "node": ""
        }
      }
    }
  }
}
```

For OneOps, you would like to have below in your configuration, so in your `config/oneops-default.json`, add:

```
{
  "services": {
    "providers": {
      "@walmart/electrode-ccm-client": {
        "options": {
          "environment": "{{env.ONEOPS_ENVPROFILE}}",
          "cloudEnvironment": "{{env.ONEOPS_ENVIRONMENT}},
          "cloud": "{{env.ONEOPS_CLOUD}}",
          "node": "{{env.ONEOPS_CI_NAME}}"
        }
      }
    }
  }
}
```

Note the `{{}}` expression requires the use of [electrode-config].

## More details

Sample code to create a CCM client yourself:

```js
const CCMClient = require("@walmart/electrode-ccm-client");

CCMClient.create(config).then(client => {
  client
    .withMeta(meta)
    .getConfig({
      serviceName: "qa-service",
      environment: "qa",
      configName: "com.walmart.atlas.CarouselConfiguration"
    })
    .then(resp => {
      console.log("response", resp);
    })
    .catch(error => {
      console.log("error", error);
    });
});
```

### getConfig

Get a configuration. See **[Parameters](#parameters)**.

### getTypedConfig

**_DEPRECATED_** - CCM has deprecated typed config. Please do not use this anymore.

Get a typed configuration, meaning its JSON string will be decoded into an
object. In addition to the standard **[Parameters](#parameters)**, you must
supply a `version` parameter to the typed config endpoint.

Sample code:

```js
return client.withMeta(meta).getTypedConfig({
  configName: "com.walmart.atlas.CarouselConfiguration",
  version: "1.0.0"
});
```

### Parameters

- `serviceName`: The application/service name. By default, the value of the
  environment variable `com.walmart.platform.config.appName`.
- `scopeName`: A scope path in the format `/path/to/scope`. By default it will
  be generated based on the default (or provided) `scopeTemplate`.
- `configName`: The name of the config to retrieve.
- `environment`: The name of the environment. By default, the value of the
  environment variable `com.walmart.platform.config.runOnEnv`, or `"qa"` if
  unset.
- `cloudEnvironment`: The name of the cloud environment. By default, the value
  of the environment variable `com.walmart.platform.config.runOnCloudEnv` or
  `ONEOPS_ENVIRONMENT`.
- `cloud`: The name of the data center. By default, the value of the environment
  variable `com.walmart.platform.config.runOnDataCenter` or `ONEOPS_CLOUD`.
- `node`: The name of the node. By default, the value of the environment
  variable `com.walmart.platform.config.runOnNode` or `ONEOPS_CI_NAME`.
- `scopeTemplate`: A string to use as a template for generating `scopeName`.
  By default, the value of the environment variable `scm.scope.template`, or `"/environment/cloud/node"` if unset. Path components can look like:
  - `param` or `{param}`: Substitute the named `param` from params.
  - `${param}`: Substitute the named environment variable `param` from the
    environment.

[electrode-config]: https://gecgithub01.walmart.com/electrode/electrode-config

