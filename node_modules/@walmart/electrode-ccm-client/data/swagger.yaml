swagger: '2.0'
info:
  version: 1.0.0
  title: CCM API
host: scm.prod.walmart.com
schemes:
  - http
  - https
basePath: /scm-app/v2
consumes:
  - application/json
produces:
  - application/json
paths:
  '/services/{serviceName}/scopes{+scopeName}/configs/{configName}':
    get:
      summary: Get configuration values
      description: |
        Get the property values of the configuration with the specified name
      operationId: getConfig
      x-wm-optional-params: true
      parameters:
        - $ref: '#/parameters/serviceName'
        - $ref: '#/parameters/scopeName'
        - $ref: '#/parameters/configName'
        - name: providerContextProperties
          in: query
          type: string
          format: byte
        - name: configContextProperties
          in: query
          type: string
          format: byte
        - name: ignoreRoot
          description: Ignore root config when assembling result
          in: query
          type: boolean

      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              status:
                type: string
              payload:
                type: object
                properties:
                  configuration:
                    type: object
                    properties:
                      properties:
                        type: object
        '404':
          description: Configuration not found

  '/services/{serviceName}/scopes{+scopeName}/tconfigs/{configName}':
    post:
      summary: Get typed configuration values
      description: |
        Get the property values of the configuration with the specified name
        as a decoded JSON object.
      operationId: getTypedConfig
      x-wm-optional-params: true
      parameters:
        - $ref: '#/parameters/serviceName'
        - $ref: '#/parameters/scopeName'
        - $ref: '#/parameters/configName'
        - $ref: '#/parameters/payload'
      responses:
        '200':
          description: OK
          schema:
            type: object
            properties:
              status:
                type: string
              payload:
                type: object
                properties:
                  configuration:
                    type: object
                    properties:
                      properties:
                        type: object
        '404':
          description: Configuration not found

  /changes:
    get:
      summary: Get recent changes
      description: |
        Get a list of recent changes to the given services, or all services if
        none were specified.
      operationId: getChanges
      parameters:
        - name: service
          in: query
          type: array
          collectionFormat: multi
          description: |
            Service(s) for which to get changes. May be used more than once to
            specify multiple services
          items:
            type: string
        - name: allowNoContent
          in: query
          type: boolean
          description: Should server return 204 if no changes were found
        - name: includeAdminChanges
          in: query
          type: boolean
          description: Include scm-admin changes
        - name: committed
          in: query
          type: boolean
          description: Get only committed changes (true by default)
        - name: changeGroup
          in: query
          type: string
          description: Filter by change group (set of change actions)
      responses:
        '200':
          description: OK. If allowNoContent, 200 indicates changes found
          schema:
            type: object
            properties:
              size:
                type: integer
              changedServices:
                type: array
                items:
                  type: string
              changes:
                type: array
                items:
                  type: object
                  properties:
                    configType:
                      type: string
                    changeType:
                      type: string
                    serviceName:
                      type: string
                    configName:
                      type: string
                    scope:
                      type: string
                    version:
                      type: integer
                    changeInVersion:
                      type: boolean
                    processedServerIP:
                      type: string
                    action:
                      type: string
                    operation:
                      type: string
                    timestamp:
                      type: integer
        '204':
          description: OK - no changes found. Enabled by allowNoContent param

  /telemetry/resolution:
    post:
      summary: Post config resolution telemetry data
      operationId: postResolutionTelemetry
      parameters:
        - name: payload
          in: body
          required: true
          schema:
            type: object
            properties:
              payload:
                type: object
                properties:
                  scope:
                    type: string
                  scopeTemplateMap:
                    type: object
                  configName:
                    type: string
                  lookupOrder:
                    type: string
                  resolvedProperties:
                    type: object
                  clientResolution:
                    type: array
                    items:
                      type: string
                  resolutions:
                    type: array
                    items:
                      type: object
                  createTime:
                    type: string
                  createTimestamp:
                    type: number
                  lastUpdateTime:
                    type: string
                  lastUpdateTimestamp:
                    type: number
                  lastResolutionTimestamp:
                    type: number
                  lastExpiredTimestamp:
                    type: number
                  resolutionCount:
                    type: number
                  updateCount:
                    type: number
                  expiredCount:
                    type: number
                  expired:
                    type: number
                  changeId:
                    type: number
                  processingTimes:
                    type: object
                  reason:
                    type: string
                  configurationChanged:
                    type: boolean
                  clientContext:
                    type: object
                  configNamespace:
                    type: string
                  providerContextProperties:
                    type: object
              serverDetails:
                type: object
                properties:
                  runOnEnv:
                    type: string
                  cloudDC:
                    type: string
                  cloudName:
                    type: string
                  ipAddress:
                    type: string
                  hostName:
                    type: string
                  timestamp:
                    type: number
      responses:
        '202':
          description: Accepted


  /telemetry/bootstrap:
    post:
      summary: Post bootstrap telemetry data
      operationId: postBootstrapTelemetry
      parameters:
        - name: payload
          in: body
          required: true
          schema:
            type: object
            properties:
              payload:
                type: object
                properties:
                  clientContext:
                    type: object
                  storeTelemetry:
                    type: object
      responses:
        '202':
          description: Accepted

parameters:
  serviceName:
    name: serviceName
    in: path
    description: |
      Name of the service/application. By default, the value of the
      environment variable `com.walmart.platform.config.appName`.
    required: true
    type: string
  scopeName:
    name: +scopeName
    in: path
    description: |
      Scope to query for configuration.
    required: true
    type: string
  configName:
    name: configName
    in: path
    description: Configuration name
    required: true
    type: string
  payload:
    name: payload
    in: body
    description: Payload
    required: true
    schema:
      type: object
      required:
        - payload
      properties:
        payload:
          type: object
          properties:
            environment:
              type: string
            node:
              type: string
            version:
              type: string
            configContextProperties:
              type: object
            providerContextProperties:
              type: object
