# electrode-health

Maintainers: [Amit Motgi](https://gecgithub01.walmart.com/amotgi)

A Hapi plugin for checking the Electrode Server Health using `electrode-health`.

## Default Config

* If no `health` config is set in the App then health check URL will be `https://{basePath}/ecv-status`

## Custom Config

```
{
  ...
  ui : {
      health : "/healthCheck"
  }
}
```

* Based on the above configuration the health check url will be `https://{basePath}/healthCheck`

## Usage

OneOps Load Balancer will keep any server in rotation only if the this plug-in is returning a HTTP status of `200`.

In order to allow SiteOps or DevOps to take one or more server out of rotation, we can use the query string parameter
`outOfRotation` to take the server OUT of rotation or put it back to rotation.

* `http(s)://{basePath}/ecv-status?outOfRotation=true` Server will be out of rotation until a restart or the opposite order.
* `http(s)://{basePath}/ecv-status?outOfRotation=false` Server will put the server back into rotation.
* `http(s)://{basePath}/ecv-status?outOfRotation=check` Server will return current rotation status without doing anything.
* `http(s)://{basePath}/ecv-status?outOfRotation=timeCheck` Server will update rotation status according to latest timestamp file.

The following payload will be returned depending on rotation status:

* For out of rotation, it will return:

```js
{
  status: 'OUT_OF_ROTATION',
  serverStartTime: '2018-1-27 10:01:33',
  timestamp: '2018-1-27 13:22:46',
  now: '2018-1-27 13:22:56',
  duration: '10.151 seconds'
}
```

* For in rotation, it will return:

```js
{
  status: 'IN_ROTATION',
  serverStartTime: '2018-1-27 13:25:45',
  timestamp: '2018-1-27 13:25:36',
  now: '2018-1-27 13:25:46'
}
```

* If `serverStartTime` is after `timestamp` then server is considered to be in rotation.

---

## Akamai Liveness Test

In order to allow Akamai to perform data centers liveness test, we can use the below url which returns 200.

* `http(s)://{basePath}/akamai-liveness-test`

---

_If you are using `electrode-server`, this plugin is enabled
[by default](https://gecgithub01.walmart.com/electrode/electrode-server/blob/master/lib/config/default.js)._
