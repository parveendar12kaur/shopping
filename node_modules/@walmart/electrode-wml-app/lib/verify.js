"use strict";

const fyi = require("@walmart/electrode-fyi");
const requireAt = require("require-at")(process.cwd());
const pkg = require("../package.json");

function pkgMajor(version) {
  const x = version.split(".")[0];
  if (x[0] === "^") {
    return x.substr(1);
  }
  return x;
}

function verifyDep() {
  Object.keys(pkg.dependencies).forEach(p => {
    const x = requireAt(`${p}/package.json`);
    const em = pkgMajor(pkg.dependencies[p]);
    const am = pkgMajor(x.version);
    if (em !== am) {
      fyi.error(
        `@walmart/electrode-wml-app dependency ${p} expected major version ${em} but ${am} was installed at top level.` // eslint-disable-line
      );
    }
  });
}

module.exports = verifyDep;
