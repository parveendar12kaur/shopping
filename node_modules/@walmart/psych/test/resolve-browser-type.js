// Load modules

var Lab = require("lab");
var Code = require("Code");
var lab = exports.lab = Lab.script();

var describe = lab.describe;
var it = lab.it;
var before = lab.before;
var after = lab.after;
var expect = Code.expect;

var Psych = require("..");

var TORBIT_HEADER_NAME = "x-tb-browser";

describe("resolve-browser-type", function () {
  it("should be a function", function (done) {
    expect(Psych.resolveBrowserType).to.be.a.function();
    done();
  });

  it("should return unknown when no headers supplied", function (done) {
  	var browserType = Psych.resolveBrowserType();

   	expect(browserType).to.equal("unknown");
    done();
  });

  it("should return unknown for empty headers", function (done) {
    var browserType = Psych.resolveBrowserType({});

    expect(browserType).to.equal("unknown");
    done();
  });

  it("should return unknown for invalid torbit header value", function (done) {
    var sampleTorbitHeader = {};
    sampleTorbitHeader[TORBIT_HEADER_NAME] = "z"
    var browserType = Psych.resolveBrowserType(sampleTorbitHeader);

    expect(browserType).to.equal("unknown");
    done();
  });

  it("should return crawler for when torbit header value is c", function (done) {
    var sampleTorbitHeader = {};
    sampleTorbitHeader[TORBIT_HEADER_NAME] = "c"
    var browserType = Psych.resolveBrowserType(sampleTorbitHeader);

    expect(browserType).to.equal("crawler");
    done();
  });
});
