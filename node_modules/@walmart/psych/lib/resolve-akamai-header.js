var ParseAkamaiHeader = require("./parse-akamai-header");

var AKAMAI_DEVICE_CHARACTERISTICS_REQUEST_HEADER_NAME = "x-akamai-device-characteristics";
var AKAMAI_IS_WIRELESS_DEVICE = "is_wireless_device";
var AKAMAI_IS_TABLET = "is_tablet";

var DEVICE_TYPE_TABLET = "tablet";
var DEVICE_TYPE_MOBILE = "mobile";
var DEVICE_TYPE_DESKTOP = "desktop";

// Use priority rules to choose from a list of modules, described here:
// https://confluence.walmart.com/display/PGPMERCHT/Default+Module+Selection+Criteria
module.exports = function (headers) {
  if (!headers || !headers[AKAMAI_DEVICE_CHARACTERISTICS_REQUEST_HEADER_NAME]) {
    return null;
  }

  var headerObj = ParseAkamaiHeader(headers[AKAMAI_DEVICE_CHARACTERISTICS_REQUEST_HEADER_NAME]);

  if (headerObj[AKAMAI_IS_TABLET] === "true") {
    return DEVICE_TYPE_DESKTOP;
  }
  else if (headerObj[AKAMAI_IS_WIRELESS_DEVICE] === "true") {
    return DEVICE_TYPE_MOBILE;
  }

  return DEVICE_TYPE_DESKTOP;
};
