var eventuate = require('eventuate');
var assign = require('object-assign');

module.exports = function createEventProducer (eventOpts) {
    var opts = assign({ historySize: 100 }, eventOpts);
    var event = Object.defineProperties(eventuate(), {
        history: { enumerable: true, value: [] },
        getHistory: { value: getHistory, configurable: true }
    });

    // on each event, update history
    event(updateHistory);

    return event;

    function getHistory (n) {
        return event.history.slice(0, n).map(justPayload);
    }

    function updateHistory (evt) {
        // newest events at beginning of array, oldest at end
        event.history.unshift(evt);
        while (event.history.length > opts.historySize) {
            event.history.pop();
        }
    }
};

function justPayload (evt) {
    return evt.payload;
}
