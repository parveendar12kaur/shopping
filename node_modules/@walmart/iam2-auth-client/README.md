# iam2-auth-client

[Electrode Swapi] client for [IAM2 Auth REST JSON APIs](https://confluence.walmart.com/display/PGPSSO/IAM2.0+REST+JSON+Payload)

## Usage

```
npm install @walmart/iam2-auth-client --save
```

## Params

Base on IAM2's spec, most of their endpoints take a JSON object with a single payload field like below:

```js
{
  payload: {
  }
}
```

In order to pass that verbatim into the service, the client take the whole thing as a parameter named `data`.  See below example.

## Sample code

```
const Iam2AuthClient = require("@walmart/iam2-auth-client");

Iam2AuthClient.create(config).then((client) => {
  return client.withMeta(meta)
    .authUser({
      data: {
        payload: {
          userId: "<user-id>",
          password: "<secret>",
          realmId: "WALMART.COM",
          tenantId: "WALMART.COM"
        }
      }
    })
    .then((resp) => {
      console.log("response", resp);
    })
    .catch((error) => {
      console.log("error", error);
    });
});
```

## Provider Name

Provider name is `iam2Auth`.

If you didn't deviate from standard configs as recommended below, then you should be able to access an instance of this client using `req.app.services.iam2Auth`.  [See below for more details](#example)

## Use In an Electrode Server App

If your application is base on the Electrode Platform, you don't have to manually initialize this client yourself.

If you are using [electrode-server] then you should be able to access an instance of this client through `request` if you had configure it in your config file.

[Details here][initializer-tldr]


### Config For Electrode App

```js
{
  "services": {
    "env": "prod",

    "providers": {
      "@walmart/iam2-auth-client": {
      }
    }
  }
}
```

### Example

With the above configuration, you can access an instance of the client like this:

```js
server.route({
  method: "GET",
  path: "/",
  handler: (req, reply) => {
    return req.app.services.iam2Auth.withMeta(req).authUser({
      data: {
        payload: {
          ...
        }
      }
    })
      .then((data) => reply(data));
  }
});
```


## APIs

TBD - [See swagger doc](data/swagger.yaml).

Paste swagger spec into [swagger editor](http://editor.swagger.io) to see documents.

[electrode-server]: https://gecgithub01.walmart.com/electrode/electrode-server
[initializer-tldr]: https://gecgithub01.walmart.com/electrode/electrode-service-initializer#tldr
[Electrode Swapi]: https://gecgithub01.walmart.com/electrode/electrode-swapi
