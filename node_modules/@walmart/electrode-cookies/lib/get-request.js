"use strict";

/* eslint-disable no-magic-numbers */

const optionalRequire = require("optional-require")(require);
const clsProvider = optionalRequire("@walmart/electrode-cls-provider");
const fyi = require("@walmart/electrode-fyi");
const tryCatch = require("@walmart/try-catch");

const hasCls = Boolean(clsProvider && clsProvider.getRequest);

fyi.info(`electrode-cookies: clsProvider.getRequest${hasCls ? "" : " not"} available`);

const fyiError = fyi.limitError("electrode-cookies", 100);

function getRequest(opts, from) {
  let req = opts && opts.request;

  // user didn't pass in opts or opts.request
  if (!req) {
    // do we have CLS provider?
    if (hasCls) {
      //
      // Get request from CLS provider to set cookies on it or get cookies from it
      //
      req = tryCatch(clsProvider.getRequest);
      if (!req) {
        fyiError(`electrode-cookies.${from} no opts.request and failed to get request from CLS`);
      }
    } else {
      fyiError(`electrode-cookies.${from} no opts.request and no CLS to get request from`);
    }
  }

  return req;
}

module.exports = getRequest;
