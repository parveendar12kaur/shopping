# Electrode Cookies

**_Please refrain from major bumping this module!  This module could be used by a lot of components and major bumping it would cause a big mess and fragmentation.  Whatever feature you need, if it can't be added in a backward compatible fashion, then it's probably not worth it._**

Electrode isomorphic cookies lib for HapiJS.

## Install

```bash
npm install @walmart/electrode-cookies --save
```

## Usage

This module offers reading and setting cookies in React code that works in both the browser or when doing Server Side Rendering.

In your pure server only code, you can also use this module to read and set cookies, but you **must** pass the `request` object in the options or must be using Electrode platform with [CLS] enabled.  Otherwise an assert error will be thrown.

> If you are using [electrode-wml-server] version 3 or below, then [CLS] is automatically enabled for you.

### Reading cookies

In ReactJS land:

```js
import Cookies from "@walmart/electrode-cookies";
const value = Cookies.get("test-cookie");
```

In NodeJS land:

> Note the difference is that `request` is passed in options.

```js
const Cookies = require("@walmart/electrode-cookies");
const value = Cookies.get("test-cookie", { request });
```

### Writing cookies

In ReactJS land:

```js
import Cookies from "@walmart/electrode-cookies";
Cookies.set( "foo", "bar", { path: "/", domain: ".walmart.com" } );
```

In NodeJS land:

> Note the difference is that `request` is passed in options.

```js
const Cookies = require("@walmart/electrode-cookies");
Cookies.set( "foo", "bar", { request, path: "/", domain: ".walmart.com" } );
```

### Isomorphic Usage

This module is designed to support universal use the same in both ReactJS (browser) and NodeJS land.

In ReactJS, if you are using the Electrode platform and [electrode-redux-router-engine], then the `request` object would've been injected into React's `context.app` object.

However, you should **not** explicitly mention `request` in your ReactJS code, so you should call the cookies API like this:

```js
Cookies.set("foo", "bar", this.context.app);
Cookies.get("foo", this.context.app);
```

If you need to pass in other options, then the recommended way is:

```js
Cookies.set("foo", "bar", Object.assign({expires: 1000}, this.context.app));
Cookies.get("foo", Object.assign({matchSubStr: true}, this.context.app));
```

## Electrode Server Setup

The cookie writing on server side requires support from a Hapi plugin.  If you use [electrode-wml-server], then it should have setup the plugin for you by default.  Otherwise, you need to register the [hapi plugin](hapi-plugin.js).

## APIs

### [Cookies.get](#cookiesget)

`Cookies.get(key, [options])`

Parameters:

-   `key` - name of the cookie
-   `options` - (optional) **_Available for Server side only._**  options for getting the cookie
    -   `request` - The server `request` object (**Required on server**).
    -   `matchSubStr` - If `true`, then do substring matching of key with all cookie keys.
        -   `skipEncoding` - (applies only if `matchSubStr` is `true`) If `true`, then do not encode the key or decode the value.

Returns the value of the cookie for `key`.

### [Cookies.set](#cookiesset)

`Cookies.set(key, value, [options])`

Set a cookie with `key` and `value`.

Parameters:

-   `key` - name of the cookie
-   `value` - value of the cookie
-   `options` - (optional) options for the cookie
    -   `request` - On the server side, the `request` object (**Required on server**).
    -   `path` - string path of the cookie **_Default:_** `"/"`
    -   `domain` - string domain of the cookie
    -   `expires` - number of seconds the cookie will expire
    -   `secure` - A boolean of whether or not the cookie should only be available over SSL **_Default:_** false
    -   `httpOnly` - A boolean of whether or not the cookie should only be available over HTTP(S) **_Default:_** false
    -   `forceAuthEncoding` - Forces non-standard encoding for `+` and `/` characters, use with auth cookies.
    -   `skipEncoding` - Skip encoding/escaping of the cookie value. See [source](https://gecgithub01.walmart.com/electrode/electrode-cookies/blob/master/lib/index.js) for details.

### [Cookies.expire](#cookiesexpire)

`Cookies.expire(key, [options])`

Expires a cookie specified by `key`.

Parameters:

-   `key` - name of the cookie
-   `options` - (optional) options for the cookie
    -   `path` - string path of the cookie **_Default:_** `"/"`
    -   `domain` - string domain of the cookie
    -   `secure` - A boolean of whether or not the cookie should only be available over SSL **_Default:_** false
    -   `request` - The server request object (**Required on server**)

[electrode-wml-server]: https://gecgithub01.walmart.com/electrode/electrode-wml-server

[electrode-redux-router-engine]: https://gecgithub01.walmart.com/electrode/electrode-redux-router-engine

[cls]: https://gecgithub01.walmart.com/electrode/electrode-cls-provider
