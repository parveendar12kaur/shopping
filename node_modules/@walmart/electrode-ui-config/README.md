# electrode-ui-config

Makes the `ui` section from your app config and the filtered CCM settings available to your UI code. It works isomorphically.

# For UI Code Only

**_This module is only for use in UI code, not for use in server only code._**

**What is UI Code?**

* UI code is where you construct and manipulate your app's UI. In Electrode, that typically means files with `jsx` extension. These code are expected to run on the browser.

**What is server only code?**

* Server only code are only ever to be executed on the server side by NodeJS. Typically you should have direct access to the `request` object.

**How do I access config in server only code?**

* You can access your app config through `request.app.config`.

**How do I access CCM in server only code?**

* You can access your app's CCM config through [request.app.ccm API](https://gecgithub01.walmart.com/electrode/electrode-ccm-initializer#the-requestappccm-api).

# Table Of Contents

* [Install](#install)
* [Setup](#setup)
* [Usage](#usage)
* [Utilities](#utilities)
  * [fullPath](#fullpath)
  * [fullApiPath](#fullapipath)
* [How it works](#how-it-works)
* [Other Requirements](#other-requirements)
  * [Configuration files](#configuration-files)
* [Server side render specific config](#server-side-render-specific-config)

## Install

    npm install @walmart/electrode-ui-config --save

## Setup

> Please read if you see the error message:

```markdown
... You are using ui-config.xxxxxx before it gets reference to your app config
```

This module only provides the isomorphic access facility to your config.

It cannot make assumption about where your config came from, even though you're probably using [@walmart/electrode-config] to manage your app config.

Still, in order to provide the facility, it needs to be able to reference your config somehow.

**_It relies on you passing your config to it. There are two ways that can be done:_**

1.  In the Electrode HapiJS world, this module provides a Hapi plugin that it expects to be registered to your Electrode Hapi server, which should have initialized the app config your passed to [electrode-wml-server] in `server.app.config`. If you are using [electrode-wml-server], this module's plugin is already part of the setup.

    Therefore, before its Hapi plugin is registered to your Electrode Hapi server, it has no reference to any config to speak of.

2.  However, you can manually set the server for this module:

```js
const uiConfig = require("@walmart/electrode-ui-config");

const myServer = {
  app: {
    config: {
      ui: {}
    }
  }
};

uiConfig._server = myServer;
```

So, if you try to use this module at a top level in any server side JS file, kind of like the sample below, then it will be invoked at **_load time_**, before setup etc has a chance to execute, then you will get the error indicated above.

```js
const uiConfig = require("@walmart/electrode-ui-config");

const myApiPath = uiConfig.fullApiPath();
```

## Usage

To access the `ui` section from your app config, use `electrode-ui-config.ui`.

For example.

```js
import Config from "@walmart/electrode-ui-config";

export default class MyComponent extends React.Component {
  render() {
    if (Config.ui.doThis) {
      return <This />;
    } else {
      return <That />;
    }
  }
}
```

To access the filtered CCM from, use `electrode-ui-config.ccm`.

For example.

```js
import Config from "@walmart/electrode-ui-config";

export default class MyComponent extends React.Component {
  render() {
    const ccmSetting = Config.ccm.someConfig["setting-key-1"];
  }
}
```

## Utilities

This module provides the following utilities:

### [fullPath](#fullpath)

`fullPath(path)`

It will join `config.ui.basePath` with `path` to make a full UI route path.

Params

* `path` - the path to join with basePath

Returns

* A full UI route path with basePath.
* if `path` is empty, then `basePath` is returned.

### fullApiPath

`fullApiPath(path)`

Joins `config.ui.basePath`, `config.ui.apiPath` and `path` to make a full API route path.
`basePath` defaults to `""`, `apiPath` defaults to `"/api"`.

Params

* `path` - the path to join with basePath and apiPath

Returns

* A full API route path. If `path` is empty, then `/<basePath>/<apiPath>` is returned.

## How it works

This package utilize a webpack feature which looks at the `browser` field in `package.json` and use that when bundling.

When running on server side, NodeJS require looks at the `main` field, which points to another file.

## Other Requirements

The client side simply uses `window._wml.config` to retrieve the config values. Your application needs to be an Electrode app that uses [electrode-server] and [electrode-react-webapp], which sends `ui` section from your app config to the browser in the Index template.

See [electrode server configuration] for details on setting up config files for your app.

### Configuration files

Sample:

```js
{
  connections: {
    ...
  },
  plugins: {
    ...
  },
  ui: {

  }
}
```

[electrode-server]: https://gecgithub01.walmart.com/electrode/electrode-server
[electrode-react-webapp]: https://gecgithub01.walmart.com/electrode/electrode-react-webapp
[electrode server configuration]: https://gecgithub01.walmart.com/electrode/electrode-server#configuration

## Server side render specific config

Occasionally apps or components need access to different config on server and client. To do this,
add a `ssrUi` property to the root level of the config object:

```js
{
  ...
  ssrUi: {
    foo: "ServerOnlyValue"
  },
  ui: {
    foo: "ClientOnlyValue"
  }
}
```

`ssrUi` properties will overwrite any matching properties defined in `ui`. Isomorphic code can use `Config.ui` and properties defined in both `ssrUi` and `ui` will only be available in the respective environments.

[electrode-wml-server]: https://gecgithub01.walmart.com/electrode/electrode-wml-server
[@walmart/electrode-config]: https://gecgithub01.walmart.com/electrode/electrode-config

