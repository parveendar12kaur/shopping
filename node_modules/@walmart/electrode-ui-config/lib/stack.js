"use strict";

/* eslint-disable no-magic-numbers */

function filter(stack) {
  const cwd = process.cwd();

  return stack
    .split("\n")
    .filter(s => {
      return (
        s.indexOf(cwd) >= 0 &&
        (s.indexOf("node_modules") < 0 ||
          (s.indexOf("node_modules/@walmart") > 0 &&
            s.indexOf("@walmart/electrode-ui-config") < 0 &&
            s.indexOf("@walmart/continuation-local-storage") < 0 &&
            s.indexOf("@walmart/async-listener") < 0))
      );
    })
    .slice(0, 4)
    .map(s => s.trim().replace(cwd, "CWD"));
}

function get() {
  const err = new Error();
  return filter(err.stack);
}

module.exports = { get, filter };
