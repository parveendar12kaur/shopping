# electrode-wml-server

This is a server that uses [electrode-server] and to provide a Node/Hapi server and adds a WML specific layer to enable support for WML backends.

The WML specific layer is added to [electrode-server] through the [decors](https://gecgithub01.walmart.com/electrode/electrode-server#electrodeserver) feature.

The WML decor added the following:

-   Default `server.config.electrode.hostname` to `OS.hostname` if it's not set
-   `server.config.electrode.hostIP` that's resolved from the hostname.
-   A DNS cache with 5 seconds refresh interval, using [dnscache module](https://www.npmjs.com/package/dnscache)

These Hapi Plugins:
-   [@walmart/electrode-appconfig](https://gecgithub01.walmart.com/electrode/electrode-appconfig)

   > A simple Hapi plugin to support app config, it provides server.app.config in request.app.config and ensure cookie is in a Hapi format.

-   [@walmart/wl-soa-esb-bug-patch](https://gecgithub01.walmart.com/electrode/wl-soa-esb-bug-patch)

   > A WalmartLabs SOA Enterprise Service Bus Proxy bug patch, it monkey patches NodeJS core to not change the WM_* headers since NodeJS core always process HTTP headers in lower case.

-   [@walmart/electrode-logging-plugin](https://gecgithub01.walmart.com/electrode/electrode-logging-plugin)

   > A Hapi plugin for logging server events using electrode-logging. Enabled by default in electrode-wml-server.

-   [@walmart/electrode-log-consumer](https://gecgithub01.walmart.com/electrode/electrode-log-consumer)

   > An electrode plugin for consuming client side logs.

-   [@walmart/electrode-service-initializer](https://gecgithub01.walmart.com/electrode/electrode-service-initializer)

   > A Hapi plugin to initialize Electrode Swapi service clients, it takes an Electrode app's services config, for each provider client and make an instance of the client available in request.app.services. The goal is to make it convenient to setup and initialize service provider clients so users can invoke the service APIs.

-   [@walmart/electrode-ccm-initializer](https://gecgithub01.walmart.com/electrode/electrode-ccm-initializer)

   > Hapi plugin to initialize and refresh CCM configs periodically. User can specify the CCM keys that CCM initializer retrieve and refresh for you. It takes autoLoad and keys as required options from your app config under ccm and registers a route /electrode/services/ccm/refresh, which electrode-wml-server invokes every certain minutes (configurable, 5 minutes by default). It also registers an onPreHandler function that checks request for expo cookies and updates request ccm accordingly.

-   [@walmart/electrode-fetch/lib/hapi-plugin](https://gecgithub01.walmart.com/electrode/electrode-fetch/blob/master/lib/hapi-plugin.js)

    > An instrumented fetch wrapper. You can send a POST/GET request, set a listener in the application and get a stream of analytics data about what's being called, what the performance numbers look like etc.

-   [@walmart/electrode-cookies/hapi-plugin](https://gecgithub01.walmart.com/electrode/electrode-cookies/blob/master/hapi-plugin.js)

   > A Electrode isomorphic cookies lib, it offers reading and setting cookies in React code that works in both the browser or when doing Server Side Rendering.

-   [@walmart/electrode-health](https://gecgithub01.walmart.com/electrode/electrode-health)

   > A Hapi plugin for checking the Electrode Server Health using electrode-health. It adds route for monitoring Electrode app health.

-   [@walmart/electrode-ui-config/hapi-plugin](https://gecgithub01.walmart.com/electrode/electrode-ui-config/blob/master/hapi-plugin.js)		
 		
>  A plugin provides isomorphic config for UI. Makes the ui section from your app config and the filtered CCM settings available to your UI code.

-   [@walmart/electrode-metrics](https://gecgithub01.walmart.com/electrode/electrode-metrics)

   > A electrode metrics library, it sends metrics data to electrode-apm, which aggregates it and reports to kafka.

-   [@walmart/electrode-static-path](https://gecgithub01.walmart.com/electrode/electrode-static-paths)
   > A electrode server decor to serve static files using inert.

-   [inert](https://github.com/hapijs/inert)
   > A static file and directory handlers plugin for hapi.js. It provides new handler methods for serving static files and directories, as well as decorating the reply interface with a file method for serving file based resources.
