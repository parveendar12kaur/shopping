# Config

This is a module that uses [confippet] to compose your Electrode NodeJS app configuration with WalmartLabs specific supports.

## Installing

```
npm install @walmart/electrode-config --save
```

## Usage

```js
const config = require("@walmart/electrode-config").config;

const prop = config.$("prop1.prop2");
```

`.config` is initialized the first time you access it.

## Configuration Files

This module uses [confippet default config files], with two additional sources, which will be loaded after the `{deployment}-{instance}` source:

  * `oneops-default` - an optional source if env var `ONEOPS_ENVPROFILE` is defined.
  * `oneops-{ONEOPS_ENVPROFILE}` - a required config source base on the env var `ONEOPS_ENVPROFILE` converted to lower cases.  You should put your services endpoints in this source.
  * `oneops-{ONEOPS_ENVPROFILE}-{instance}` - for multi-instances deployments.
  
### Sample Config Files

Here is a sample of what you might have in your `config` directory:

```
config/
  default.json
  development.json
  production.json
  oneops-default.json
  oneops-dev.json
  oneops-staging.json
  oneops-prod.json
```

When running on your local dev, with `NODE_ENV` unset or set to `development` and `ONEOPS_ENVPROFILE` unset, the config files that are loaded will be: `default.json`, `development.json`.
 
When running on a OneOps dev cloud, with `NODE_ENV=production` and `ONEOPS_ENVPROFILE=dev`, the config files that are loaded will be: `default.json`, `production.json`, `oneops-default.json`, `oneops-dev.json`.

With `NODE_ENV=production` and `ONEOPS_ENVPROFILE=prod`, the config files that are loaded will be: `default.json`, `production.json`, `oneops-default.json`, `oneops-prod.json`.

With `NODE_ENV=development` and `ONEOPS_ENVPROFILE=dev`, the config files that are loaded will be: `default.json`, `development.json`, `oneops-default.json`, `oneops-dev.json`.


## Environment Variables

  * `ONEOPS_ENVPROFILE` - the OneOps cloud environment.  This is automatically set by OneOps.  It will be converted to lower cases.  Typical values are: `dev`, `prod`, `qa`, `staging`.
  
  * Since your config is loaded using [confippet]'s `presetConfig`, you can also use [confippet's preset config env vars].

## Templates In String Config Values

Your config is automatically processed using [confippet template processor].

## Rationale

When we run Electrode apps on OneOps cloud, regardless what cloud environment your OneOps is, `NODE_ENV` will always be set to `production`.  We do this because we want to always test your app on staging running in production mode, and some 3rd party modules could have `NODE_ENV` dependent behaviors.


[confippet]: https://gecgithub01.walmart.com/electrode/electrode-confippet
[confippet default config files]: https://gecgithub01.walmart.com/electrode/electrode-confippet#default-config-files-settings
[confippet template processor]: https://gecgithub01.walmart.com/electrode/electrode-confippet/blob/master/templates.md
[confippet's preset config env vars]: https://gecgithub01.walmart.com/electrode/electrode-confippet#environment-variables
