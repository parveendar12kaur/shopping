"use strict";

const Path = require("path");
const tryCatch = require("@walmart/try-catch");
const _ = require("lodash");

/*
 * The files webpack generated are uploaded to CDN (pronto), which returns new
 * unique URLs for each file.  In order to translate the webpack generated filename
 * to the CDN URL, filenames are extracted from the assets.json file along
 * with the corresponding CDN URL.
 *
 * This mapping is then returned in the Index template and any file loaded with the
 * webpack cdn-file-loader are then loaded by looking up the CDN URL using the file's
 * webpack generated name.
 */

module.exports = function mapCdnAssets(assetPath) {
  assetPath = assetPath || process.cwd();

  const cdn = tryCatch(() => require(Path.join(assetPath, "config/assets.json"))); // eslint-disable-line

  return cdn ? _.mapKeys(cdn, (url, filePath) => Path.basename(filePath)) : undefined;
};
