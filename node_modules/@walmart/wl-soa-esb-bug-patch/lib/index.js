"use strict";

/* eslint-disable global-require */

let hapiPkg;
try {
  hapiPkg = require("hapi/package.json");
} catch (err) {
  // ignore
}

/* eslint-disable no-invalid-this, quotes, curly, max-len, no-magic-numbers, prefer-template, global-require */

/*
 * WalmartLabs SOA Enterprise System Bus (ESB) Proxy 1.0 doesn't honor HTTP spec and require all "WM_*"
 * header field names to be upper case.
 *
 * http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html
 *
 * This was their response:
 *
 *
 * > I understand that as per RFC 2616, headers are case insensitive, but, SOARI 1.0 and ESB expect headers to be in upper
 * > case. Unfortunately, thatâ€™s the behavior limitation in SOA 1.0. As we move towards SOA 2.0, we will be rectifying this.
 *
 *
 * But NodeJS core always process HTTP headers in lower case.
 *
 * So we have to monkey patch NodeJS core to _not_ change the "WM_*" headers.
 *
 */

const major = +process.versions.node.split(".")[0];

const hapiMajor = hapiPkg ? +hapiPkg.version.split(".")[0] : 16;

if (major < 8) {
  module.exports = require("./hack-4-6");
} else if (hapiMajor < 17) {
  module.exports = require("./hack-8-to-10-hapi16");
} else {
  module.exports = require("./hack-8-to-10-hapi17");
}
